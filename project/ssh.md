# SSH(Secure Shell)

원격 서버/서비스에 안전하게 접속하는 프로토콜

## HTTPS vs SSH 연결 차이

- HTTP / HTTPS
  - 카테고리: **웹 전송 프로토콜**
  - 역할: 브라우저와 웹 서버가 문서, 이미지, API 데이터 등을 주고받는 규약
  - HTTPS는 HTTP에 SSL/TLS 보안 계층을 추가한 버전
- SSH
  - 카테고리: **원격 접속/보안 프로토콜**
  - 역할: 네트워크를 통해 원격 서버에 로그인·명령 실행·파일 전송을 안전하게 하기 위한 규약
  - GitHub에서 쓰이는 이유: **인증 수단** => 매번 비밀번호를 입력하는 대신 공개키/비밀키 기반 인증

## 동작 원리

문을 열 수 있는 열쇠(비밀키)는 나만 갖고 있고 자물쇠(공개키)는 서버에 걸어두는 구조

- 비대칭 암호화: 두 개의 키가 쌍으로 동작해 비밀번호 없이도 안전하게 인증 가능
  - **비밀키 (Private Key)**
    - 내 컴퓨터에만 저장됨 (~/.ssh/id_rsa)
    - 절대 공유하면 안 됨
    - 서버와 통신할 때 실제 **열쇠** 역할
  - **공개키 (Public Key)**
    - 자유롭게 배포 가능 (~/.ssh/id_rsa.pub)
    - 원격 서버(GitHub 등)에 등록해둠
    - 서버는 공개키를 보고 **이 사람이 가진 비밀키와 맞는지** 확인

## Github SSH 설정 후 git clone을 하면 발생하는 일

요약

1. 통신 전체를 보호할 암호화 채널(SSH)을 만듦
2. 공개키/비밀키 방식으로 사용자 인증
3. 인증 성공 시, 그 채널 그대로 사용해서 Git 데이터 전송

### 1단계: 보안 채널 수립

사용자 인증(ID/PW나 키 인증)을 시작하기 전, 클라이언트와 서버는 먼저 **아무도 엿들을 수 없는 비밀 통로**를 만듦

1. TCP 연결
   - 내 컴퓨터(클라이언트)가 GitHub 서버의 SSH 포트(22번)로 연결 요청
   - TCP 3-way handshake
2. SSH 프로토콜 버전 교환
3. 암호화 알고리즘 협상
   - 앞으로 통신을 암호화할 때 어떤 알고리즘을 사용할지 서로 합의
4. 보안 키(세션 키) 교환(Diffie-Hellman Key Exchange)
   - 이 단계에서만 사용할 **임시 대칭 키를 생성**하고 교환
     - 대칭 키 자체를 교환하는 것은 아님
     - 안전하게 같은 키를 양쪽이 계산할 수 있게 만드는 수학적 절차
   - 중간에 해커가 통신을 가로채더라도 안전함
     - 이해를 돕기 위한 비유: **물감 섞기**
   - 세션 키의 역할
     - SSH로 실제 데이터 전송 시 대칭 암호 사용
     - 전송한 데이터의 무결성 검증
     - 세션이 끝나면 무효, 재사용 불가 => 해커가 탈취해도 다음 접속에서 사용할 수 없음

### 2단계: 사용자 인증

1단계에서 만들어진 암호화된 비밀 통로 안에서, 사용자를 확인하는 절차 시작

1. 클라이언트 요청 시작
   - `git clone git@github.com:username/repo.git`
   - git이 내부적으로 SSH 프로토콜을 사용해 git@github.com에 연결 시도
2. 서버(GitHub)의 확인
   - Github에서 이 사용자가 인증된 사용자인지 확인하기 위해 원문 형태의 무작위 문자열, **challenge**를 보냄
3. 클라이언트의 응답: 서명 생성
   - 내 로컬의 비밀키가 사용됨
   - 클라이언트는 **GitHub가 보낸 challenge를 비밀키로 서명(signature)해서 돌려줌**
   - 이때 비밀키는 절대 네트워크에 직접 전송되지 않고, 비밀키로 만든 **새로운 서명(증명값)만 보냄**
4. 서버(GitHub)의 검증
   - GitHub는 **계정에 미리 등록된 공개키를 사용해, 클라이언트가 보낸 서명이 유효한지 검증**
   - 검증 성공 시 -> '비밀키를 가진 혼모노다!'하고 인증됨
   - 검증 실패 시 -> '이건 내가 등록해둔 키 쌍과 안 맞는다'하고 거부

### 3단계: 데이터 전송

- SSH 연결이 그대로 유지됨
- Git은 이 SSH 채널을 통해 레포 데이터를 내 컴퓨터로 전송 시작 => clone 작업 완료

## 참고

- [IBM Developer - Getting started with SSH security and configuration](https://developer.ibm.com/articles/au-sshsecurity/)
